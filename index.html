<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>PotolokForLife - –ö–∞–ª—å–∫—É–ª—è—Ç–æ—Ä –Ω–∞—Ç—è–∂–Ω—ã—Ö –ø–æ—Ç–æ–ª–∫–æ–≤</title>
    <!-- Telegram Web App SDK -->
    <script src="https://telegram.org/js/telegram-web-app.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        :root {
            --primary-color: #1e3c72;
            --secondary-color: #2a5298;
            --accent-color: #3a6bc9;
            --light-color: #f5f7fa;
            --dark-color: #333;
            --success-color: #28a745;
            --warning-color: #ffc107;
            --danger-color: #dc3545;
            --border-radius: 12px;
            --box-shadow: 0 4px 12px rgba(0,0,0,0.1);
            --transition: all 0.3s ease;
        }
        
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            -webkit-tap-highlight-color: transparent;
        }
        
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, sans-serif;
            background: var(--light-color);
            color: var(--dark-color);
            line-height: 1.5;
            overflow-x: hidden;
            padding: 0;
        }
        
        .container {
            max-width: 100%;
            padding: 15px;
            margin: 0 auto;
        }
        
        /* Header */
        .header {
            background: linear-gradient(135deg, var(--primary-color), var(--secondary-color));
            color: white;
            padding: 20px 15px;
            border-radius: var(--border-radius);
            margin-bottom: 20px;
            box-shadow: var(--box-shadow);
            position: relative;
            overflow: hidden;
        }
        
        .header::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            height: 4px;
            background: linear-gradient(90deg, #ffd700, #ffed4e);
        }
        
        .logo {
            text-align: center;
            margin-bottom: 15px;
        }
        
        .logo h1 {
            font-size: 1.5rem;
            margin-bottom: 5px;
            font-weight: 700;
        }
        
        .logo p {
            font-size: 0.9rem;
            opacity: 0.9;
        }
        
        .contact-info {
            display: flex;
            flex-direction: column;
            gap: 8px;
            font-size: 0.85rem;
        }
        
        .contact-item {
            display: flex;
            align-items: center;
            gap: 8px;
        }
        
        .contact-item i {
            width: 20px;
            text-align: center;
        }
        
        /* Mobile Navigation */
        .mobile-nav {
            display: flex;
            justify-content: space-between;
            margin-bottom: 20px;
            background: white;
            border-radius: var(--border-radius);
            padding: 10px;
            box-shadow: var(--box-shadow);
            position: sticky;
            top: 10px;
            z-index: 100;
        }
        
        .nav-tab {
            flex: 1;
            text-align: center;
            padding: 12px 5px;
            border: none;
            background: none;
            font-weight: 600;
            color: #666;
            border-radius: 8px;
            transition: var(--transition);
            font-size: 0.9rem;
        }
        
        .nav-tab.active {
            background: var(--primary-color);
            color: white;
        }
        
        /* Tab Content */
        .tab-content {
            display: none;
        }
        
        .tab-content.active {
            display: block;
            animation: fadeIn 0.3s ease;
        }
        
        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }
        
        /* Cards */
        .card {
            background: white;
            border-radius: var(--border-radius);
            padding: 20px;
            margin-bottom: 20px;
            box-shadow: var(--box-shadow);
            transition: var(--transition);
        }
        
        .card:active {
            transform: scale(0.98);
        }
        
        .card-title {
            color: var(--primary-color);
            margin-bottom: 20px;
            padding-bottom: 10px;
            border-bottom: 2px solid #f0f0f0;
            font-size: 1.2rem;
            display: flex;
            align-items: center;
            gap: 10px;
        }
        
        .card-title i {
            font-size: 1.1rem;
        }
        
        /* Input Groups */
        .input-group {
            margin-bottom: 20px;
        }
        
        .input-group label {
            display: block;
            margin-bottom: 8px;
            font-weight: 600;
            color: #444;
            font-size: 0.95rem;
        }
        
        .input-group input, 
        .input-group select,
        .input-group textarea {
            width: 100%;
            padding: 14px 15px;
            border: 2px solid #e0e0e0;
            border-radius: 10px;
            font-size: 1rem;
            transition: var(--transition);
            background: #f9f9f9;
            -webkit-appearance: none;
            appearance: none;
        }
        
        .input-group input:focus, 
        .input-group select:focus,
        .input-group textarea:focus {
            border-color: var(--accent-color);
            outline: none;
            background: white;
            box-shadow: 0 0 0 3px rgba(58, 107, 201, 0.1);
        }
        
        /* Row for multiple inputs */
        .input-row {
            display: flex;
            gap: 10px;
            margin-bottom: 20px;
        }
        
        .input-row .input-group {
            flex: 1;
            margin-bottom: 0;
        }
        
        /* System Selector */
        .system-selector {
            display: flex;
            flex-wrap: wrap;
            gap: 8px;
            margin-bottom: 20px;
        }
        
        .system-btn {
            flex: 1;
            min-width: 120px;
            padding: 12px 15px;
            background: #f0f0f0;
            border: none;
            border-radius: 8px;
            font-weight: 600;
            font-size: 0.9rem;
            transition: var(--transition);
            text-align: center;
        }
        
        .system-btn.active {
            background: var(--primary-color);
            color: white;
        }
        
        /* Services List */
        .services-list {
            max-height: 400px;
            overflow-y: auto;
            -webkit-overflow-scrolling: touch;
            margin-top: 10px;
            border: 1px solid #eee;
            border-radius: 10px;
            padding: 5px;
        }
        
        .service-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 15px;
            border-bottom: 1px solid #f5f5f5;
            transition: var(--transition);
        }
        
        .service-item:last-child {
            border-bottom: none;
        }
        
        .service-info {
            flex: 1;
            padding-right: 10px;
        }
        
        .service-name {
            font-weight: 600;
            margin-bottom: 3px;
            font-size: 0.95rem;
        }
        
        .service-unit {
            font-size: 0.8rem;
            color: #666;
        }
        
        .service-controls {
            display: flex;
            align-items: center;
            gap: 10px;
        }
        
        .service-price {
            font-weight: 700;
            color: var(--primary-color);
            min-width: 70px;
            text-align: right;
            font-size: 0.95rem;
        }
        
        .quantity-input {
            width: 70px;
            padding: 10px;
            text-align: center;
            border: 1px solid #ddd;
            border-radius: 6px;
            font-weight: 600;
            font-size: 1rem;
            -webkit-appearance: none;
            appearance: none;
        }
        
        /* Results */
        .results {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 15px;
            margin-top: 20px;
        }
        
        .result-box {
            background: #f8f9fa;
            padding: 15px;
            border-radius: 10px;
            text-align: center;
            border: 2px solid #e9ecef;
        }
        
        .result-label {
            font-size: 0.85rem;
            color: #666;
            margin-bottom: 5px;
        }
        
        .result-value {
            font-size: 1.3rem;
            font-weight: 800;
            color: var(--primary-color);
        }
        
        /* Payment Info */
        .payment-info {
            background: #f0f7ff;
            border-left: 5px solid var(--primary-color);
            padding: 20px;
            margin-top: 20px;
            border-radius: 10px;
        }
        
        .payment-info h3 {
            color: var(--primary-color);
            margin-bottom: 15px;
            font-size: 1.1rem;
        }
        
        .payment-info ul {
            padding-left: 20px;
        }
        
        .payment-info li {
            margin-bottom: 10px;
            line-height: 1.5;
            font-size: 0.9rem;
        }
        
        .highlight {
            background-color: #fffacd;
            padding: 2px 6px;
            border-radius: 4px;
            font-weight: 600;
        }
        
        /* Summary Table */
        .summary-table-container {
            max-height: 300px;
            overflow-y: auto;
            -webkit-overflow-scrolling: touch;
            margin-top: 20px;
            border: 1px solid #eee;
            border-radius: 10px;
        }
        
        .summary-table {
            width: 100%;
            border-collapse: collapse;
            font-size: 0.9rem;
        }
        
        .summary-table th, 
        .summary-table td {
            padding: 12px 10px;
            text-align: left;
            border-bottom: 1px solid #eee;
        }
        
        .summary-table th {
            background: #f8f9fa;
            color: var(--primary-color);
            font-weight: 700;
            position: sticky;
            top: 0;
        }
        
        .total-row {
            background: #f0f7ff;
            font-weight: 700;
        }
        
        .total-row td {
            border-top: 2px solid var(--primary-color);
        }
        
        /* Empty State */
        .empty-state {
            text-align: center;
            padding: 40px 20px;
            color: #666;
        }
        
        .empty-state i {
            font-size: 3rem;
            margin-bottom: 15px;
            opacity: 0.5;
        }
        
        /* Charts */
        .chart-container {
            background: white;
            border-radius: var(--border-radius);
            padding: 20px;
            margin-bottom: 20px;
            box-shadow: var(--box-shadow);
        }
        
        .chart-title {
            text-align: center;
            color: var(--primary-color);
            margin-bottom: 15px;
            font-size: 1.1rem;
        }
        
        /* Buttons */
        .buttons-container {
            display: flex;
            flex-direction: column;
            gap: 15px;
            margin: 25px 0;
            position: sticky;
            bottom: 0;
            background: var(--light-color);
            padding: 15px 0;
            border-top: 1px solid #ddd;
        }
        
        .btn {
            padding: 16px 20px;
            border: none;
            border-radius: 10px;
            font-size: 1rem;
            font-weight: 700;
            cursor: pointer;
            transition: var(--transition);
            text-align: center;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 10px;
        }
        
        .btn:active {
            transform: scale(0.98);
        }
        
        .btn-primary {
            background: linear-gradient(135deg, var(--primary-color), var(--secondary-color));
            color: white;
        }
        
        .btn-primary:active {
            background: linear-gradient(135deg, var(--secondary-color), var(--primary-color));
        }
        
        .btn-secondary {
            background: #f0f0f0;
            color: #333;
        }
        
        .btn-secondary:active {
            background: #e0e0e0;
        }
        
        .btn-success {
            background: var(--success-color);
            color: white;
        }
        
        /* Telegram button */
        .btn-telegram {
            background: linear-gradient(135deg, #0088cc, #00aced);
            color: white;
        }
        
        /* Object Info */
        .object-info {
            background: #e8f4ff;
            padding: 15px;
            border-radius: 10px;
            margin-bottom: 20px;
        }
        
        .object-info h3 {
            color: var(--primary-color);
            margin-bottom: 10px;
            font-size: 1.1rem;
        }
        
        /* Accordion for services */
        .accordion {
            margin-bottom: 15px;
        }
        
        .accordion-header {
            background: #f8f9fa;
            padding: 15px;
            border-radius: 8px;
            font-weight: 700;
            color: var(--primary-color);
            display: flex;
            justify-content: space-between;
            align-items: center;
            cursor: pointer;
            border: 1px solid #e9ecef;
        }
        
        .accordion-content {
            padding: 15px;
            border: 1px solid #e9ecef;
            border-top: none;
            border-radius: 0 0 8px 8px;
            background: white;
            display: none;
        }
        
        .accordion.active .accordion-content {
            display: block;
        }
        
        /* Swipe indicator */
        .swipe-hint {
            text-align: center;
            color: #666;
            font-size: 0.8rem;
            margin-top: 10px;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 5px;
        }
        
        /* Responsive adjustments */
        @media (max-width: 480px) {
            .container {
                padding: 10px;
            }
            
            .card {
                padding: 15px;
            }
            
            .input-row {
                flex-direction: column;
                gap: 15px;
            }
            
            .system-btn {
                min-width: 100px;
            }
            
            .service-controls {
                flex-direction: column;
                align-items: flex-end;
                gap: 8px;
            }
            
            .quantity-input {
                width: 60px;
            }
            
            .results {
                grid-template-columns: 1fr;
                gap: 10px;
            }
            
            .btn {
                padding: 18px 20px;
            }
        }
        
        @media (min-width: 768px) {
            .container {
                max-width: 750px;
            }
            
            .header {
                display: flex;
                justify-content: space-between;
                align-items: center;
            }
            
            .logo {
                text-align: left;
                margin-bottom: 0;
            }
            
            .contact-info {
                text-align: right;
            }
        }
        
        /* Loading indicator */
        .loading {
            display: inline-block;
            width: 20px;
            height: 20px;
            border: 3px solid rgba(255,255,255,.3);
            border-radius: 50%;
            border-top-color: white;
            animation: spin 1s ease-in-out infinite;
        }
        
        @keyframes spin {
            to { transform: rotate(360deg); }
        }
        
        /* Toast notifications */
        .toast {
            position: fixed;
            bottom: 20px;
            left: 50%;
            transform: translateX(-50%);
            background: var(--dark-color);
            color: white;
            padding: 15px 20px;
            border-radius: 8px;
            box-shadow: 0 5px 15px rgba(0,0,0,0.2);
            z-index: 1000;
            font-weight: 600;
            display: none;
            max-width: 90%;
            text-align: center;
        }
        
        .toast.show {
            display: block;
            animation: slideUp 0.3s ease;
        }
        
        @keyframes slideUp {
            from { opacity: 0; transform: translate(-50%, 20px); }
            to { opacity: 1; transform: translate(-50%, 0); }
        }
        
        /* Custom scrollbar */
        ::-webkit-scrollbar {
            width: 6px;
        }
        
        ::-webkit-scrollbar-track {
            background: #f1f1f1;
            border-radius: 10px;
        }
        
        ::-webkit-scrollbar-thumb {
            background: #c1c1c1;
            border-radius: 10px;
        }
        
        ::-webkit-scrollbar-thumb:hover {
            background: #a8a8a8;
        }
    </style>
</head>
<body>
    <div class="container">
        <!-- Telegram Status -->
        <div id="telegramStatus" style="display: none; background: #0088cc; color: white; padding: 10px; border-radius: 8px; margin-bottom: 15px; text-align: center;">
            <i class="fab fa-telegram"></i> –û—Ç–∫—Ä—ã—Ç–æ –≤ Telegram
        </div>
        
        <header class="header">
            <div class="logo">
                <h1><i class="fas fa-home"></i> PotolokForLife</h1>
                <p>–ù–∞—Ç—è–∂–Ω—ã–µ –ø–æ—Ç–æ–ª–∫–∏ –Ω–∞ –≤—Å—é –∂–∏–∑–Ω—å</p>
            </div>
            <div class="contact-info">
                <div class="contact-item">
                    <i class="fas fa-envelope"></i>
                    <span>Potolokforlife@yandex.ru</span>
                </div>
                <div class="contact-item">
                    <i class="fas fa-phone"></i>
                    <span>8(977)531-10-99</span>
                </div>
                <div class="contact-item">
                    <i class="fas fa-map-marker-alt"></i>
                    <span>–ü—É—à–∫–∏–Ω–æ</span>
                </div>
            </div>
        </header>
        
        <!-- Mobile Navigation Tabs -->
        <div class="mobile-nav">
            <button class="nav-tab active" data-tab="parameters">
                <i class="fas fa-ruler-combined"></i> –ü–∞—Ä–∞–º–µ—Ç—Ä—ã
            </button>
            <button class="nav-tab" data-tab="services">
                <i class="fas fa-tools"></i> –£—Å–ª—É–≥–∏
            </button>
            <button class="nav-tab" data-tab="results">
                <i class="fas fa-calculator"></i> –†–∞—Å—á–µ—Ç
            </button>
        </div>
        
        <!-- Tab 1: Parameters -->
        <div class="tab-content active" id="parameters-tab">
            <div class="card">
                <h2 class="card-title"><i class="fas fa-info-circle"></i> –ò–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –æ–± –æ–±—ä–µ–∫—Ç–µ</h2>
                
                <div class="object-info">
                    <div class="input-group">
                        <label>–¢–∏–ø –æ–±—ä–µ–∫—Ç–∞</label>
                        <select id="objectType">
                            <option value="–∫–≤–∞—Ä—Ç–∏—Ä–∞">–ö–≤–∞—Ä—Ç–∏—Ä–∞</option>
                            <option value="–¥–æ–º">–ß–∞—Å—Ç–Ω—ã–π –¥–æ–º</option>
                            <option value="–æ—Ñ–∏—Å">–û—Ñ–∏—Å</option>
                            <option value="–º–∞–≥–∞–∑–∏–Ω">–ú–∞–≥–∞–∑–∏–Ω</option>
                        </select>
                    </div>
                    
                    <div class="input-group">
                        <label>–ö–æ–ª–∏—á–µ—Å—Ç–≤–æ –ø–æ–º–µ—â–µ–Ω–∏–π</label>
                        <input type="number" id="roomCount" value="1" min="1">
                    </div>
                    
                    <div class="input-group">
                        <label>–ê–¥—Ä–µ—Å –æ–±—ä–µ–∫—Ç–∞</label>
                        <input type="text" id="objectAddress" placeholder="–í–≤–µ–¥–∏—Ç–µ –∞–¥—Ä–µ—Å">
                    </div>
                </div>
                
                <h2 class="card-title"><i class="fas fa-cog"></i> –°–∏—Å—Ç–µ–º–∞ –ø–æ—Ç–æ–ª–∫–∞</h2>
                <div class="system-selector">
                    <button class="system-btn active" data-system="garpun">
                        <i class="fas fa-thumbs-up"></i> –ì–∞—Ä–ø—É–Ω
                    </button>
                    <button class="system-btn" data-system="garpun10">
                        <i class="fas fa-star"></i> –ì–∞—Ä–ø—É–Ω +10%
                    </button>
                </div>
                
                <h2 class="card-title"><i class="fas fa-cube"></i> –û—Å–Ω–æ–≤–Ω—ã–µ –ø–∞—Ä–∞–º–µ—Ç—Ä—ã</h2>
                <div class="input-row">
                    <div class="input-group">
                        <label><i class="fas fa-square"></i> –ü–ª–æ—â–∞–¥—å (S)</label>
                        <input type="number" id="area" value="0" min="0" step="0.01" placeholder="–º¬≤">
                    </div>
                    <div class="input-group">
                        <label><i class="fas fa-ruler"></i> –ü–µ—Ä–∏–º–µ—Ç—Ä (P)</label>
                        <input type="number" id="perimeter" value="0" min="0" step="0.01" placeholder="–º.–ø.">
                    </div>
                </div>
                
                <div class="input-group">
                    <label><i class="fas fa-arrows-alt-v"></i> –í—ã—Å–æ—Ç–∞ (h)</label>
                    <input type="number" id="height" value="0" min="0" step="0.01" placeholder="–º">
                </div>
                
                <div class="input-group">
                    <label><i class="fas fa-palette"></i> –¢–∏–ø –ø–æ–ª–æ—Ç–Ω–∞</label>
                    <select id="canvasType">
                        <option value="msd">MSD Premium –±–µ–ª–æ–µ –º–∞—Ç–æ–≤–æ–µ</option>
                        <option value="satin">–°–∞—Ç–∏–Ω –±–µ–ª—ã–π</option>
                        <option value="glossy">–ì–ª—è–Ω—Ü–µ–≤–æ–µ –±–µ–ª–æ–µ</option>
                        <option value="color">–¶–≤–µ—Ç–Ω–æ–µ –º–∞—Ç–æ–≤–æ–µ</option>
                    </select>
                </div>
            </div>
            
            <div class="swipe-hint">
                <i class="fas fa-hand-point-right"></i>
                <span>–õ–∏—Å—Ç–∞–π—Ç–µ –≤–ø—Ä–∞–≤–æ –¥–ª—è –≤—ã–±–æ—Ä–∞ —É—Å–ª—É–≥</span>
            </div>
        </div>
        
        <!-- Tab 2: Services -->
        <div class="tab-content" id="services-tab">
            <div class="card">
                <h2 class="card-title"><i class="fas fa-tools"></i> –û—Å–Ω–æ–≤–Ω—ã–µ —Ä–∞–±–æ—Ç—ã</h2>
                <div class="swipe-hint">
                    <i class="fas fa-hand-point-up"></i>
                    <span>–ù–∞–∂–º–∏—Ç–µ –Ω–∞ –∫–∞—Ç–µ–≥–æ—Ä–∏—é –¥–ª—è —Ä–∞—Å–∫—Ä—ã—Ç–∏—è —Å–ø–∏—Å–∫–∞</span>
                </div>
                
                <!-- Accordion for services -->
                <div class="accordion active" id="basic-services">
                    <div class="accordion-header">
                        <span>–û—Å–Ω–æ–≤–Ω—ã–µ —ç–ª–µ–º–µ–Ω—Ç—ã –ø–æ—Ç–æ–ª–∫–∞</span>
                        <i class="fas fa-chevron-down"></i>
                    </div>
                    <div class="accordion-content">
                        <div class="services-list" id="basicServicesList">
                            <!-- Basic services will be loaded here -->
                        </div>
                    </div>
                </div>
                
                <div class="accordion" id="lighting-services">
                    <div class="accordion-header">
                        <span>–û—Å–≤–µ—â–µ–Ω–∏–µ –∏ —ç–ª–µ–∫—Ç—Ä–æ—Ç–µ—Ö–Ω–∏–∫–∞</span>
                        <i class="fas fa-chevron-down"></i>
                    </div>
                    <div class="accordion-content">
                        <div class="services-list" id="lightingServicesList">
                            <!-- Lighting services will be loaded here -->
                        </div>
                    </div>
                </div>
                
                <div class="accordion" id="additional-services">
                    <div class="accordion-header">
                        <span>–î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ —Ä–∞–±–æ—Ç—ã</span>
                        <i class="fas fa-chevron-down"></i>
                    </div>
                    <div class="accordion-content">
                        <div class="services-list" id="additionalServicesList">
                            <!-- Additional services will be loaded here -->
                        </div>
                    </div>
                </div>
                
                <div class="accordion" id="equipment-section">
                    <div class="accordion-header">
                        <span>–û–±–æ—Ä—É–¥–æ–≤–∞–Ω–∏–µ</span>
                        <i class="fas fa-chevron-down"></i>
                    </div>
                    <div class="accordion-content">
                        <div class="services-list" id="equipmentList">
                            <!-- Equipment will be loaded here -->
                        </div>
                    </div>
                </div>
            </div>
            
            <div class="swipe-hint">
                <i class="fas fa-hand-point-right"></i>
                <span>–õ–∏—Å—Ç–∞–π—Ç–µ –≤–ø—Ä–∞–≤–æ –¥–ª—è –ø—Ä–æ—Å–º–æ—Ç—Ä–∞ —Ä–∞—Å—á–µ—Ç–∞</span>
            </div>
        </div>
        
        <!-- Tab 3: Results -->
        <div class="tab-content" id="results-tab">
            <div class="card">
                <h2 class="card-title"><i class="fas fa-calculator"></i> –°–≤–æ–¥–∫–∞ –ø–æ —Å—Ç–æ–∏–º–æ—Å—Ç–∏</h2>
                
                <div class="results">
                    <div class="result-box">
                        <div class="result-label">–ú–∞—Ç–µ—Ä–∏–∞–ª—ã</div>
                        <div class="result-value" id="materialsCost">0 —Ä—É–±.</div>
                    </div>
                    <div class="result-box">
                        <div class="result-label">–†–∞–±–æ—Ç—ã</div>
                        <div class="result-value" id="workCost">0 —Ä—É–±.</div>
                    </div>
                    <div class="result-box">
                        <div class="result-label">–û–±–æ—Ä—É–¥–æ–≤–∞–Ω–∏–µ</div>
                        <div class="result-value" id="equipmentCost">0 —Ä—É–±.</div>
                    </div>
                    <div class="result-box">
                        <div class="result-label">–ò—Ç–æ–≥–æ</div>
                        <div class="result-value" id="totalCost">0 —Ä—É–±.</div>
                    </div>
                </div>
                
                <div class="payment-info">
                    <h3><i class="fas fa-credit-card"></i> –ü–æ—Ä—è–¥–æ–∫ –æ–ø–ª–∞—Ç—ã</h3>
                    <ul>
                        <li>–ü—Ä–µ–¥–æ–ø–ª–∞—Ç–∞ <span class="highlight" id="prepaymentAmount">0 —Ä—É–±.</span> (50%) –∑–∞ 3 –¥–Ω—è –¥–æ –º–æ–Ω—Ç–∞–∂–∞</li>
                        <li>–û–ø–ª–∞—Ç–∞ –æ–±–æ—Ä—É–¥–æ–≤–∞–Ω–∏—è: 100% –ø–µ—Ä–µ–¥ –Ω–∞—á–∞–ª–æ–º —Ä–∞–±–æ—Ç</li>
                        <li>–û–∫–æ–Ω—á–∞—Ç–µ–ª—å–Ω—ã–π —Ä–∞—Å—á–µ—Ç <span class="highlight" id="finalPaymentAmount">0 —Ä—É–±.</span> (50%) –≤ –¥–µ–Ω—å –∑–∞–≤–µ—Ä—à–µ–Ω–∏—è —Ä–∞–±–æ—Ç</li>
                    </ul>
                </div>
                
                <h2 class="card-title"><i class="fas fa-list-alt"></i> –î–µ—Ç–∞–ª–∏–∑–∞—Ü–∏—è —Å–º–µ—Ç—ã</h2>
                <div class="summary-table-container">
                    <table class="summary-table" id="summaryTable">
                        <thead>
                            <tr>
                                <th>–ù–∞–∏–º–µ–Ω–æ–≤–∞–Ω–∏–µ</th>
                                <th>–ö–æ–ª-–≤–æ</th>
                                <th>–¶–µ–Ω–∞</th>
                                <th>–°—É–º–º–∞</th>
                            </tr>
                        </thead>
                        <tbody id="summaryTableBody">
                            <tr>
                                <td colspan="4" class="empty-state">
                                    <i class="fas fa-clipboard-list"></i>
                                    <p>–î–æ–±–∞–≤—å—Ç–µ —ç–ª–µ–º–µ–Ω—Ç—ã –¥–ª—è —Ä–∞—Å—á–µ—Ç–∞</p>
                                </td>
                            </tr>
                        </tbody>
                    </table>
                </div>
            </div>
            
            <div class="chart-container">
                <div class="chart-title"><i class="fas fa-chart-pie"></i> –†–∞—Å–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ —Å—Ç–æ–∏–º–æ—Å—Ç–∏</div>
                <canvas id="costDistributionChart"></canvas>
            </div>
            
            <div class="swipe-hint">
                <i class="fas fa-hand-point-left"></i>
                <span>–õ–∏—Å—Ç–∞–π—Ç–µ –≤–ª–µ–≤–æ –¥–ª—è –∏–∑–º–µ–Ω–µ–Ω–∏—è –ø–∞—Ä–∞–º–µ—Ç—Ä–æ–≤</span>
            </div>
        </div>
        
        <!-- Action Buttons -->
        <div class="buttons-container">
            <button class="btn btn-primary" id="calculateBtn">
                <i class="fas fa-calculator"></i> –†–∞—Å—Å—á–∏—Ç–∞—Ç—å —Å–º–µ—Ç—É
            </button>
            
            <div class="input-row">
                <button class="btn btn-secondary" id="resetBtn">
                    <i class="fas fa-redo"></i> –°–±—Ä–æ—Å–∏—Ç—å
                </button>
                <button class="btn btn-success" id="saveBtn">
                    <i class="fas fa-save"></i> –°–æ—Ö—Ä–∞–Ω–∏—Ç—å
                </button>
            </div>
            
            <button class="btn btn-primary" id="printBtn">
                <i class="fas fa-print"></i> –ü–µ—á–∞—Ç—å —Å–º–µ—Ç—ã
            </button>
            
            <!-- Telegram Send Button -->
            <button class="btn btn-telegram" id="telegramBtn">
                <i class="fab fa-telegram"></i> –û—Ç–ø—Ä–∞–≤–∏—Ç—å –≤ Telegram
            </button>
        </div>
        
        <!-- Toast Notification -->
        <div class="toast" id="toast"></div>
    </div>

    <script>
        // –î–∞–Ω–Ω—ã–µ –∏–∑ Excel —Ñ–∞–π–ª–∞ —Å –≥—Ä—É–ø–ø–∏—Ä–æ–≤–∫–æ–π –ø–æ –∫–∞—Ç–µ–≥–æ—Ä–∏—è–º
        const systemsData = {
            garpun: {
                name: "–ì–∞—Ä–ø—É–Ω–Ω–∞—è —Å–∏—Å—Ç–µ–º–∞ —Å–æ –≤—Å—Ç–∞–≤–∫–æ–π –ø–æ –ø–µ—Ä–∏–º–µ—Ç—Ä—É",
                basicServices: [
                    { id: 1, name: "–ü–æ–ª–æ—Ç–Ω–æ MSD Premium –±–µ–ª–æ–µ –º–∞—Ç–æ–≤–æ–µ —Å —É—Å—Ç–∞–Ω–æ–≤–∫–æ–π", unit: "–º¬≤", price: 610, basePrice: 550, category: "basic" },
                    { id: 2, name: "–ü—Ä–æ—Ñ–∏–ª—å —Å—Ç–µ–Ω–æ–≤–æ–π/–ø–æ—Ç–æ–ª–æ—á–Ω—ã–π –≥–∞—Ä–ø—É–Ω–Ω—ã–π —Å —É—Å—Ç–∞–Ω–æ–≤–∫–æ–π", unit: "–º.–ø.", price: 310, basePrice: 280, category: "basic" },
                    { id: 3, name: "–í—Å—Ç–∞–≤–∫–∞ –ø–æ –ø–µ—Ä–∏–º–µ—Ç—Ä—É –≥–∞—Ä–ø—É–Ω–Ω–∞—è", unit: "–º.–ø.", price: 220, basePrice: 200, category: "basic" }
                ],
                lightingServices: [
                    { id: 4, name: "–ú–æ–Ω—Ç–∞–∂ –∑–∞–∫–ª–∞–¥–Ω—ã—Ö –ø–æ–¥ —Å–≤–µ—Ç–∏–ª—å–Ω–∏–∫–∏", unit: "—à—Ç.", price: 780, basePrice: 700, category: "lighting" },
                    { id: 5, name: "–ú–æ–Ω—Ç–∞–∂ –∑–∞–∫–ª–∞–¥–Ω—ã—Ö –ø–æ–¥ —Å–¥–≤–æ–µ–Ω–Ω—ã–µ —Å–≤–µ—Ç–∏–ª—å–Ω–∏–∫–∏", unit: "—à—Ç.", price: 1350, basePrice: 1200, category: "lighting" },
                    { id: 6, name: "–ú–æ–Ω—Ç–∞–∂ –∑–∞–∫–ª–∞–¥–Ω—ã—Ö –ø–æ–¥ –ª—é—Å—Ç—Ä—É", unit: "—à—Ç.", price: 1100, basePrice: 900, category: "lighting" },
                    { id: 7, name: "–ú–æ–Ω—Ç–∞–∂ –∑–∞–∫–ª–∞–¥–Ω–æ–π –¥–ª—è –≤–µ–Ω—Ç–∏–ª—è—Ç–æ—Ä–∞", unit: "—à—Ç.", price: 1300, basePrice: 1200, category: "lighting" },
                    { id: 16, name: "–ú–æ–Ω—Ç–∞–∂ '–ø–∞—Ä—è—â–µ–≥–æ' –ø–æ—Ç–æ–ª–∫–∞ —Å LED –ª–µ–Ω—Ç–æ–π", unit: "–º.–ø.", price: 1600, basePrice: 1300, category: "lighting" },
                    { id: 17, name: "–ú–æ–Ω—Ç–∞–∂ —Å–∏—Å—Ç–µ–º—ã 'EuroKRAAB'", unit: "–º.–ø.", price: 1600, basePrice: 1300, category: "lighting" },
                    { id: 18, name: "–ú–æ–Ω—Ç–∞–∂ —Å–≤–µ—Ç–æ–≤—ã—Ö –ª–∏–Ω–∏–π —Å LED –ª–µ–Ω—Ç–æ–π", unit: "–º.–ø.", price: 3400, basePrice: 2800, category: "lighting" },
                    { id: 22, name: "–ú–æ–Ω—Ç–∞–∂ —Ç—Ä–µ–∫–æ–≤–æ–≥–æ –æ—Å–≤–µ—â–µ–Ω–∏—è (–≤—Å—Ç—Ä–∞–∏–≤–∞–µ–º–æ–µ)", unit: "–º.–ø.", price: 3400, basePrice: 2800, category: "lighting" },
                    { id: 23, name: "–ú–æ–Ω—Ç–∞–∂ —Ç—Ä–µ–∫–æ–≤–æ–≥–æ –æ—Å–≤–µ—â–µ–Ω–∏—è (–Ω–∞–∫–ª–∞–¥–Ω–æ–µ)", unit: "–º.–ø.", price: 1100, basePrice: 900, category: "lighting" }
                ],
                additionalServices: [
                    { id: 8, name: "–ú–æ–Ω—Ç–∞–∂ –∑–∞–∫–ª–∞–¥–Ω–æ–π –ø–æ–¥ –ø–æ—Ç–æ–ª–æ—á–Ω—ã–π –∫–∞—Ä–Ω–∏–∑", unit: "–º.–ø.", price: 650, basePrice: 550, category: "additional" },
                    { id: 9, name: "–£—Å—Ç–∞–Ω–æ–≤–∫–∞ –ø–æ—Ç–æ–ª–æ—á–Ω–æ–≥–æ –∫–∞—Ä–Ω–∏–∑–∞", unit: "–º.–ø.", price: 270, basePrice: 220, category: "additional" },
                    { id: 10, name: "–£—Å—Ç–∞–Ω–æ–≤–∫–∞ —Ä–∞–∑–¥–µ–ª–∏—Ç–µ–ª–µ–π", unit: "–º.–ø.", price: 1700, basePrice: 1500, category: "additional" },
                    { id: 11, name: "–ú–æ–Ω—Ç–∞–∂ –∑–∞–∫–ª–∞–¥–Ω—ã—Ö –ø–æ–¥ –≤—Å—Ç—Ä–∞–∏–≤–∞–µ–º—ã–µ —à–∫–∞—Ñ—ã", unit: "–º.–ø.", price: 1100, basePrice: 900, category: "additional" },
                    { id: 12, name: "–ú–æ–Ω—Ç–∞–∂ —à—Ç–æ—Ä–Ω—ã—Ö –∫–∞—Ä–Ω–∏–∑–æ–≤ (–¥–≤—É—Ö—Ä—è–¥–Ω—ã–π)", unit: "–º.–ø.", price: 4000, basePrice: 3600, category: "additional" },
                    { id: 13, name: "–ú–æ–Ω—Ç–∞–∂ —à—Ç–æ—Ä–Ω—ã—Ö –∫–∞—Ä–Ω–∏–∑–æ–≤ (—Ç—Ä–µ—Ö—Ä—è–¥–Ω—ã–π)", unit: "–º.–ø.", price: 4500, basePrice: 4100, category: "additional" },
                    { id: 14, name: "–†–∞–±–æ—Ç—ã –ø–æ –∫–µ—Ä–∞–º–∏—á–µ—Å–∫–æ–π –ø–ª–∏—Ç–∫–µ", unit: "–º.–ø.", price: 400, basePrice: 350, category: "additional" },
                    { id: 15, name: "–£—Å—Ç–∞–Ω–æ–≤–∫–∞ –≤–µ–Ω—Ç–∏–ª—è—Ü–∏–æ–Ω–Ω–æ–π —Ä–µ—à–µ—Ç–∫–∏", unit: "—à—Ç.", price: 600, basePrice: 500, category: "additional" },
                    { id: 19, name: "–ú–æ–Ω—Ç–∞–∂ –æ—Ç–∫—Ä—ã—Ç–æ–π –Ω–∏—à–∏", unit: "–º.–ø.", price: 1200, basePrice: 1000, category: "additional" },
                    { id: 20, name: "–ú–æ–Ω—Ç–∞–∂ –Ω–∏—à–∏ —Å –ø–æ–≤–æ—Ä–æ—Ç–æ–º –ø–æ–ª–æ—Ç–Ω–∞", unit: "–º.–ø.", price: 3000, basePrice: 2500, category: "additional" },
                    { id: 21, name: "–ú–æ–Ω—Ç–∞–∂ –ø–µ—Ä–µ—Ö–æ–¥–∞ —É—Ä–æ–≤–Ω—è", unit: "–º.–ø.", price: 3700, basePrice: 3100, category: "additional" }
                ],
                equipment: [
                    { id: 1, name: "–°–≤–µ—Ç–∏–ª—å–Ω–∏–∫", unit: "—à—Ç.", price: 600, category: "equipment" }
                ]
            },
            garpun10: {
                name: "–ì–∞—Ä–ø—É–Ω–Ω–∞—è —Å–∏—Å—Ç–µ–º–∞ (+10%)",
                basicServices: [
                    { id: 1, name: "–ü–æ–ª–æ—Ç–Ω–æ MSD Premium –±–µ–ª–æ–µ –º–∞—Ç–æ–≤–æ–µ —Å —É—Å—Ç–∞–Ω–æ–≤–∫–æ–π", unit: "–º¬≤", price: 670, basePrice: 610, category: "basic" },
                    { id: 2, name: "–ü—Ä–æ—Ñ–∏–ª—å —Å—Ç–µ–Ω–æ–≤–æ–π/–ø–æ—Ç–æ–ª–æ—á–Ω—ã–π –≥–∞—Ä–ø—É–Ω–Ω—ã–π —Å —É—Å—Ç–∞–Ω–æ–≤–∫–æ–π", unit: "–º.–ø.", price: 340, basePrice: 310, category: "basic" },
                    { id: 3, name: "–í—Å—Ç–∞–≤–∫–∞ –ø–æ –ø–µ—Ä–∏–º–µ—Ç—Ä—É –≥–∞—Ä–ø—É–Ω–Ω–∞—è", unit: "–º.–ø.", price: 240, basePrice: 220, category: "basic" }
                ],
                lightingServices: [
                    { id: 4, name: "–ú–æ–Ω—Ç–∞–∂ –∑–∞–∫–ª–∞–¥–Ω—ã—Ö –ø–æ–¥ —Å–≤–µ—Ç–∏–ª—å–Ω–∏–∫–∏", unit: "—à—Ç.", price: 900, basePrice: 780, category: "lighting" },
                    { id: 5, name: "–ú–æ–Ω—Ç–∞–∂ –∑–∞–∫–ª–∞–¥–Ω—ã—Ö –ø–æ–¥ —Å–¥–≤–æ–µ–Ω–Ω—ã–µ —Å–≤–µ—Ç–∏–ª—å–Ω–∏–∫–∏", unit: "—à—Ç.", price: 1500, basePrice: 1350, category: "lighting" },
                    { id: 6, name: "–ú–æ–Ω—Ç–∞–∂ –∑–∞–∫–ª–∞–¥–Ω—ã—Ö –ø–æ–¥ –ª—é—Å—Ç—Ä—É", unit: "—à—Ç.", price: 1200, basePrice: 1100, category: "lighting" },
                    { id: 7, name: "–ú–æ–Ω—Ç–∞–∂ –∑–∞–∫–ª–∞–¥–Ω–æ–π –¥–ª—è –≤–µ–Ω—Ç–∏–ª—è—Ç–æ—Ä–∞", unit: "—à—Ç.", price: 1450, basePrice: 1300, category: "lighting" },
                    { id: 16, name: "–ú–æ–Ω—Ç–∞–∂ '–ø–∞—Ä—è—â–µ–≥–æ' –ø–æ—Ç–æ–ª–∫–∞ —Å LED –ª–µ–Ω—Ç–æ–π", unit: "–º.–ø.", price: 1750, basePrice: 1600, category: "lighting" },
                    { id: 17, name: "–ú–æ–Ω—Ç–∞–∂ —Å–∏—Å—Ç–µ–º—ã 'EuroKRAAB'", unit: "–º.–ø.", price: 1750, basePrice: 1600, category: "lighting" },
                    { id: 18, name: "–ú–æ–Ω—Ç–∞–∂ —Å–≤–µ—Ç–æ–≤—ã—Ö –ª–∏–Ω–∏–π —Å LED –ª–µ–Ω—Ç–æ–π", unit: "–º.–ø.", price: 3750, basePrice: 3400, category: "lighting" },
                    { id: 22, name: "–ú–æ–Ω—Ç–∞–∂ —Ç—Ä–µ–∫–æ–≤–æ–≥–æ –æ—Å–≤–µ—â–µ–Ω–∏—è (–≤—Å—Ç—Ä–∞–∏–≤–∞–µ–º–æ–µ)", unit: "–º.–ø.", price: 3750, basePrice: 3400, category: "lighting" },
                    { id: 23, name: "–ú–æ–Ω—Ç–∞–∂ —Ç—Ä–µ–∫–æ–≤–æ–≥–æ –æ—Å–≤–µ—â–µ–Ω–∏—è (–Ω–∞–∫–ª–∞–¥–Ω–æ–µ)", unit: "–º.–ø.", price: 1200, basePrice: 1100, category: "lighting" }
                ],
                additionalServices: [
                    { id: 8, name: "–ú–æ–Ω—Ç–∞–∂ –∑–∞–∫–ª–∞–¥–Ω–æ–π –ø–æ–¥ –ø–æ—Ç–æ–ª–æ—á–Ω—ã–π –∫–∞—Ä–Ω–∏–∑", unit: "–º.–ø.", price: 720, basePrice: 650, category: "additional" },
                    { id: 9, name: "–£—Å—Ç–∞–Ω–æ–≤–∫–∞ –ø–æ—Ç–æ–ª–æ—á–Ω–æ–≥–æ –∫–∞—Ä–Ω–∏–∑–∞", unit: "–º.–ø.", price: 300, basePrice: 270, category: "additional" },
                    { id: 10, name: "–£—Å—Ç–∞–Ω–æ–≤–∫–∞ —Ä–∞–∑–¥–µ–ª–∏—Ç–µ–ª–µ–π", unit: "–º.–ø.", price: 1900, basePrice: 1700, category: "additional" },
                    { id: 11, name: "–ú–æ–Ω—Ç–∞–∂ –∑–∞–∫–ª–∞–¥–Ω—ã—Ö –ø–æ–¥ –≤—Å—Ç—Ä–∞–∏–≤–∞–µ–º—ã–µ —à–∫–∞—Ñ—ã", unit: "–º.–ø.", price: 1200, basePrice: 1100, category: "additional" },
                    { id: 12, name: "–ú–æ–Ω—Ç–∞–∂ —à—Ç–æ—Ä–Ω—ã—Ö –∫–∞—Ä–Ω–∏–∑–æ–≤ (–¥–≤—É—Ö—Ä—è–¥–Ω—ã–π)", unit: "–º.–ø.", price: 4500, basePrice: 4000, category: "additional" },
                    { id: 13, name: "–ú–æ–Ω—Ç–∞–∂ —à—Ç–æ—Ä–Ω—ã—Ö –∫–∞—Ä–Ω–∏–∑–æ–≤ (—Ç—Ä–µ—Ö—Ä—è–¥–Ω—ã–π)", unit: "–º.–ø.", price: 5000, basePrice: 4500, category: "additional" },
                    { id: 14, name: "–†–∞–±–æ—Ç—ã –ø–æ –∫–µ—Ä–∞–º–∏—á–µ—Å–∫–æ–π –ø–ª–∏—Ç–∫–µ", unit: "–º.–ø.", price: 450, basePrice: 400, category: "additional" },
                    { id: 15, name: "–£—Å—Ç–∞–Ω–æ–≤–∫–∞ –≤–µ–Ω—Ç–∏–ª—è—Ü–∏–æ–Ω–Ω–æ–π —Ä–µ—à–µ—Ç–∫–∏", unit: "—à—Ç.", price: 650, basePrice: 600, category: "additional" },
                    { id: 19, name: "–ú–æ–Ω—Ç–∞–∂ –æ—Ç–∫—Ä—ã—Ç–æ–π –Ω–∏—à–∏", unit: "–º.–ø.", price: 1350, basePrice: 1200, category: "additional" },
                    { id: 20, name: "–ú–æ–Ω—Ç–∞–∂ –Ω–∏—à–∏ —Å –ø–æ–≤–æ—Ä–æ—Ç–æ–º –ø–æ–ª–æ—Ç–Ω–∞", unit: "–º.–ø.", price: 3300, basePrice: 3000, category: "additional" },
                    { id: 21, name: "–ú–æ–Ω—Ç–∞–∂ –ø–µ—Ä–µ—Ö–æ–¥–∞ —É—Ä–æ–≤–Ω—è", unit: "–º.–ø.", price: 4100, basePrice: 3700, category: "additional" }
                ],
                equipment: [
                    { id: 1, name: "–°–≤–µ—Ç–∏–ª—å–Ω–∏–∫", unit: "—à—Ç.", price: 650, category: "equipment" }
                ]
            }
        };

        // –ü–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è
        let currentSystem = 'garpun';
        let selectedServices = [];
        let selectedEquipment = [];
        let costChart = null;
        let tg = null; // Telegram Web App –æ–±—ä–µ–∫—Ç
        
        // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –ø—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ —Å—Ç—Ä–∞–Ω–∏—Ü—ã
        document.addEventListener('DOMContentLoaded', function() {
            // –ü—Ä–æ–≤–µ—Ä—è–µ–º, –æ—Ç–∫—Ä—ã—Ç–æ –ª–∏ –≤ Telegram
            initializeTelegram();
            
            initializeMobileNavigation();
            initializeSystemSelector();
            initializeAccordions();
            loadServices();
            initializeCharts();
            setupEventListeners();
            calculateEstimate();
            
            // –ü–æ–∫–∞–∑–∞—Ç—å –ø–æ–¥—Å–∫–∞–∑–∫—É –ø—Ä–∏ –ø–µ—Ä–≤–æ–º –ø–æ—Å–µ—â–µ–Ω–∏–∏
            if (!localStorage.getItem('potolokAppVisited')) {
                showToast('–î–æ–±—Ä–æ –ø–æ–∂–∞–ª–æ–≤–∞—Ç—å! –õ–∏—Å—Ç–∞–π—Ç–µ –≤–ø—Ä–∞–≤–æ –¥–ª—è –Ω–∞–≤–∏–≥–∞—Ü–∏–∏', 3000);
                localStorage.setItem('potolokAppVisited', 'true');
            }
        });
        
        // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è Telegram Web App
        function initializeTelegram() {
            if (window.Telegram && window.Telegram.WebApp) {
                tg = window.Telegram.WebApp;
                
                // –ù–∞—Å—Ç—Ä–∞–∏–≤–∞–µ–º Telegram Web App
                tg.expand(); // –†–∞—Å–∫—Ä—ã–≤–∞–µ–º –Ω–∞ –≤–µ—Å—å —ç–∫—Ä–∞–Ω
                tg.setHeaderColor('#1e3c72');
                tg.setBackgroundColor('#f5f7fa');
                
                // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º —Å—Ç–∞—Ç—É—Å Telegram
                document.getElementById('telegramStatus').style.display = 'block';
                
                // –ù–∞—Å—Ç—Ä–∞–∏–≤–∞–µ–º –æ—Å–Ω–æ–≤–Ω—É—é –∫–Ω–æ–ø–∫—É –≤ Telegram
                tg.MainButton.setText("üì§ –û—Ç–ø—Ä–∞–≤–∏—Ç—å —Å–º–µ—Ç—É");
                tg.MainButton.onClick(sendToTelegram);
                tg.MainButton.show();
                
                // –î–æ–±–∞–≤–ª—è–µ–º –∫–Ω–æ–ø–∫—É "–ù–∞–∑–∞–¥"
                tg.BackButton.show();
                tg.BackButton.onClick(function() {
                    const currentTab = document.querySelector('.nav-tab.active').dataset.tab;
                    if (currentTab === 'results') {
                        document.querySelector('.nav-tab[data-tab="services"]').click();
                    } else if (currentTab === 'services') {
                        document.querySelector('.nav-tab[data-tab="parameters"]').click();
                    } else {
                        tg.close();
                    }
                });
                
                console.log('Telegram Web App –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä–æ–≤–∞–Ω');
            }
        }
        
        // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –º–æ–±–∏–ª—å–Ω–æ–π –Ω–∞–≤–∏–≥–∞—Ü–∏–∏
        function initializeMobileNavigation() {
            const navTabs = document.querySelectorAll('.nav-tab');
            const tabContents = document.querySelectorAll('.tab-content');
            
            navTabs.forEach(tab => {
                tab.addEventListener('click', function() {
                    const targetTab = this.dataset.tab;
                    
                    // –û–±–Ω–æ–≤–ª—è–µ–º –∞–∫—Ç–∏–≤–Ω—É—é –≤–∫–ª–∞–¥–∫—É
                    navTabs.forEach(t => t.classList.remove('active'));
                    this.classList.add('active');
                    
                    // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤—É—é—â–∏–π –∫–æ–Ω—Ç–µ–Ω—Ç
                    tabContents.forEach(content => {
                        content.classList.remove('active');
                        if (content.id === `${targetTab}-tab`) {
                            content.classList.add('active');
                        }
                    });
                    
                    // –ü—Ä–æ–∫—Ä—É—á–∏–≤–∞–µ–º –∫ –Ω–∞—á–∞–ª—É –≤–∫–ª–∞–¥–∫–∏
                    window.scrollTo({ top: 0, behavior: 'smooth' });
                    
                    // –û–±–Ω–æ–≤–ª—è–µ–º —Ä–∞—Å—á–µ—Ç –ø—Ä–∏ –ø–µ—Ä–µ—Ö–æ–¥–µ –Ω–∞ –≤–∫–ª–∞–¥–∫—É —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤
                    if (targetTab === 'results') {
                        calculateEstimate();
                    }
                });
            });
            
            // –î–æ–±–∞–≤–ª—è–µ–º –æ–±—Ä–∞–±–æ—Ç—á–∏–∫–∏ —Å–≤–∞–π–ø–æ–≤
            let touchStartX = 0;
            let touchEndX = 0;
            
            document.addEventListener('touchstart', e => {
                touchStartX = e.changedTouches[0].screenX;
            });
            
            document.addEventListener('touchend', e => {
                touchEndX = e.changedTouches[0].screenX;
                handleSwipe();
            });
            
            function handleSwipe() {
                const swipeThreshold = 50;
                const swipeDistance = touchEndX - touchStartX;
                
                if (Math.abs(swipeDistance) < swipeThreshold) return;
                
                const currentTab = document.querySelector('.nav-tab.active').dataset.tab;
                let targetTab = currentTab;
                
                if (swipeDistance > 0) {
                    // –°–≤–∞–π–ø –≤–ø—Ä–∞–≤–æ - –ø—Ä–µ–¥—ã–¥—É—â–∞—è –≤–∫–ª–∞–¥–∫–∞
                    if (currentTab === 'services') targetTab = 'parameters';
                    else if (currentTab === 'results') targetTab = 'services';
                } else {
                    // –°–≤–∞–π–ø –≤–ª–µ–≤–æ - —Å–ª–µ–¥—É—é—â–∞—è –≤–∫–ª–∞–¥–∫–∞
                    if (currentTab === 'parameters') targetTab = 'services';
                    else if (currentTab === 'services') targetTab = 'results';
                }
                
                if (targetTab !== currentTab) {
                    document.querySelector(`.nav-tab[data-tab="${targetTab}"]`).click();
                }
            }
        }
        
        // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –≤—ã–±–æ—Ä–∞ —Å–∏—Å—Ç–µ–º—ã
        function initializeSystemSelector() {
            const systemButtons = document.querySelectorAll('.system-btn');
            systemButtons.forEach(btn => {
                btn.addEventListener('click', function() {
                    systemButtons.forEach(b => b.classList.remove('active'));
                    this.classList.add('active');
                    currentSystem = this.dataset.system;
                    loadServices();
                    calculateEstimate();
                    showToast(`–í—ã–±—Ä–∞–Ω–∞ —Å–∏—Å—Ç–µ–º–∞: ${systemsData[currentSystem].name}`, 2000);
                });
            });
        }
        
        // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –∞–∫–∫–æ—Ä–¥–µ–æ–Ω–æ–≤
        function initializeAccordions() {
            const accordions = document.querySelectorAll('.accordion');
            accordions.forEach(accordion => {
                const header = accordion.querySelector('.accordion-header');
                header.addEventListener('click', function() {
                    accordion.classList.toggle('active');
                    const icon = this.querySelector('i');
                    icon.classList.toggle('fa-chevron-down');
                    icon.classList.toggle('fa-chevron-up');
                });
            });
        }
        
        // –ó–∞–≥—Ä—É–∑–∫–∞ —É—Å–ª—É–≥ –≤ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ –æ—Ç –≤—ã–±—Ä–∞–Ω–Ω–æ–π —Å–∏—Å—Ç–µ–º—ã
        function loadServices() {
            const system = systemsData[currentSystem];
            
            // –ó–∞–≥—Ä—É–∂–∞–µ–º –æ—Å–Ω–æ–≤–Ω—ã–µ —É—Å–ª—É–≥–∏
            const basicServicesList = document.getElementById('basicServicesList');
            basicServicesList.innerHTML = '';
            system.basicServices.forEach(service => {
                basicServicesList.appendChild(createServiceElement(service));
            });
            
            // –ó–∞–≥—Ä—É–∂–∞–µ–º —É—Å–ª—É–≥–∏ –ø–æ –æ—Å–≤–µ—â–µ–Ω–∏—é
            const lightingServicesList = document.getElementById('lightingServicesList');
            lightingServicesList.innerHTML = '';
            system.lightingServices.forEach(service => {
                lightingServicesList.appendChild(createServiceElement(service));
            });
            
            // –ó–∞–≥—Ä—É–∂–∞–µ–º –¥–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ —É—Å–ª—É–≥–∏
            const additionalServicesList = document.getElementById('additionalServicesList');
            additionalServicesList.innerHTML = '';
            system.additionalServices.forEach(service => {
                additionalServicesList.appendChild(createServiceElement(service));
            });
            
            // –ó–∞–≥—Ä—É–∂–∞–µ–º –æ–±–æ—Ä—É–¥–æ–≤–∞–Ω–∏–µ
            const equipmentList = document.getElementById('equipmentList');
            equipmentList.innerHTML = '';
            system.equipment.forEach(item => {
                equipmentList.appendChild(createServiceElement(item, true));
            });
        }
        
        // –°–æ–∑–¥–∞–Ω–∏–µ —ç–ª–µ–º–µ–Ω—Ç–∞ —É—Å–ª—É–≥–∏
        function createServiceElement(service, isEquipment = false) {
            const element = document.createElement('div');
            element.className = 'service-item';
            element.innerHTML = `
                <div class="service-info">
                    <div class="service-name">${service.name}</div>
                    <div class="service-unit">${service.unit}</div>
                </div>
                <div class="service-controls">
                    <div class="service-price">${service.price} —Ä—É–±.</div>
                    <input type="number" class="quantity-input" 
                           data-id="${service.id}" 
                           data-type="${isEquipment ? 'equipment' : 'service'}"
                           data-category="${service.category}"
                           min="0" value="0" step="1">
                </div>
            `;
            
            // –î–æ–±–∞–≤–ª—è–µ–º –æ–±—Ä–∞–±–æ—Ç—á–∏–∫ —Å–æ–±—ã—Ç–∏—è –¥–ª—è –ø–æ–ª—è –≤–≤–æ–¥–∞
            const input = element.querySelector('.quantity-input');
            input.addEventListener('input', calculateEstimate);
            input.addEventListener('change', calculateEstimate);
            
            // –î–æ–±–∞–≤–ª—è–µ–º –æ–±—Ä–∞–±–æ—Ç—á–∏–∫ –¥–ª—è –±—ã—Å—Ç—Ä–æ–≥–æ –≤–≤–æ–¥–∞ (+, -)
            input.addEventListener('touchstart', function(e) {
                if (e.target.tagName === 'INPUT') return;
                
                const rect = this.getBoundingClientRect();
                const x = e.touches[0].clientX - rect.left;
                const width = rect.width;
                
                if (x < width / 3) {
                    // –ù–∞–∂–∞—Ç–∏–µ –Ω–∞ –ª–µ–≤—É—é —Ç—Ä–µ—Ç—å - —É–º–µ–Ω—å—à–µ–Ω–∏–µ
                    this.value = Math.max(0, parseInt(this.value) - 1);
                    this.dispatchEvent(new Event('input'));
                } else if (x > 2 * width / 3) {
                    // –ù–∞–∂–∞—Ç–∏–µ –Ω–∞ –ø—Ä–∞–≤—É—é —Ç—Ä–µ—Ç—å - —É–≤–µ–ª–∏—á–µ–Ω–∏–µ
                    this.value = parseInt(this.value) + 1;
                    this.dispatchEvent(new Event('input'));
                }
            });
            
            return element;
        }
        
        // –ù–∞—Å—Ç—Ä–æ–π–∫–∞ —Å–ª—É—à–∞—Ç–µ–ª–µ–π —Å–æ–±—ã—Ç–∏–π
        function setupEventListeners() {
            document.getElementById('calculateBtn').addEventListener('click', calculateEstimate);
            document.getElementById('resetBtn').addEventListener('click', resetCalculator);
            document.getElementById('saveBtn').addEventListener('click', saveEstimate);
            document.getElementById('printBtn').addEventListener('click', printEstimate);
            document.getElementById('telegramBtn').addEventListener('click', sendToTelegram);
            
            // –°–ª—É—à–∞—Ç–µ–ª–∏ –¥–ª—è –ø–æ–ª–µ–π –≤–≤–æ–¥–∞ –ø–∞—Ä–∞–º–µ—Ç—Ä–æ–≤
            document.getElementById('area').addEventListener('input', calculateEstimate);
            document.getElementById('perimeter').addEventListener('input', calculateEstimate);
            document.getElementById('height').addEventListener('input', calculateEstimate);
            document.getElementById('canvasType').addEventListener('change', calculateEstimate);
            document.getElementById('objectType').addEventListener('change', calculateEstimate);
            document.getElementById('roomCount').addEventListener('input', calculateEstimate);
            document.getElementById('objectAddress').addEventListener('input', updateSummary);
            
            // –û–±—Ä–∞–±–æ—Ç–∫–∞ –Ω–∞–∂–∞—Ç–∏—è –∫–Ω–æ–ø–æ–∫ –Ω–∞ –º–æ–±–∏–ª—å–Ω—ã—Ö —É—Å—Ç—Ä–æ–π—Å—Ç–≤–∞—Ö
            document.querySelectorAll('button').forEach(btn => {
                btn.addEventListener('touchstart', function() {
                    this.style.opacity = '0.8';
                });
                
                btn.addEventListener('touchend', function() {
                    this.style.opacity = '1';
                });
            });
        }
        
        // –†–∞—Å—á–µ—Ç —Å–º–µ—Ç—ã
        function calculateEstimate() {
            const system = systemsData[currentSystem];
            const area = parseFloat(document.getElementById('area').value) || 0;
            const perimeter = parseFloat(document.getElementById('perimeter').value) || 0;
            
            // –°–±—Ä–∞—Å—ã–≤–∞–µ–º –º–∞—Å—Å–∏–≤—ã –≤—ã–±—Ä–∞–Ω–Ω—ã—Ö —É—Å–ª—É–≥
            selectedServices = [];
            selectedEquipment = [];
            
            // –°–æ–±–∏—Ä–∞–µ–º –≤—ã–±—Ä–∞–Ω–Ω—ã–µ —É—Å–ª—É–≥–∏ –∏–∑ –≤—Å–µ—Ö –∫–∞—Ç–µ–≥–æ—Ä–∏–π
            document.querySelectorAll('.quantity-input[data-type="service"]').forEach(input => {
                const quantity = parseInt(input.value) || 0;
                if (quantity > 0) {
                    const serviceId = parseInt(input.dataset.id);
                    const category = input.dataset.category;
                    
                    // –ù–∞—Ö–æ–¥–∏–º —É—Å–ª—É–≥—É –≤ —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤—É—é—â–µ–π –∫–∞—Ç–µ–≥–æ—Ä–∏–∏
                    let service;
                    if (category === 'basic') {
                        service = system.basicServices.find(s => s.id === serviceId);
                    } else if (category === 'lighting') {
                        service = system.lightingServices.find(s => s.id === serviceId);
                    } else if (category === 'additional') {
                        service = system.additionalServices.find(s => s.id === serviceId);
                    }
                    
                    if (service) {
                        selectedServices.push({
                            ...service,
                            quantity,
                            total: service.price * quantity
                        });
                    }
                }
            });
            
            // –°–æ–±–∏—Ä–∞–µ–º –≤—ã–±—Ä–∞–Ω–Ω–æ–µ –æ–±–æ—Ä—É–¥–æ–≤–∞–Ω–∏–µ
            document.querySelectorAll('.quantity-input[data-type="equipment"]').forEach(input => {
                const quantity = parseInt(input.value) || 0;
                if (quantity > 0) {
                    const equipmentId = parseInt(input.dataset.id);
                    const equipment = system.equipment.find(e => e.id === equipmentId);
                    if (equipment) {
                        selectedEquipment.push({
                            ...equipment,
                            quantity,
                            total: equipment.price * quantity
                        });
                    }
                }
            });
            
            // –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –¥–æ–±–∞–≤–ª—è–µ–º –æ—Å–Ω–æ–≤–Ω—ã–µ —ç–ª–µ–º–µ–Ω—Ç—ã –Ω–∞ –æ—Å–Ω–æ–≤–µ –≤–≤–µ–¥–µ–Ω–Ω—ã—Ö –ø–∞—Ä–∞–º–µ—Ç—Ä–æ–≤
            // –ü–æ–ª–æ—Ç–Ω–æ (–µ—Å–ª–∏ —É–∫–∞–∑–∞–Ω–∞ –ø–ª–æ—â–∞–¥—å)
            if (area > 0) {
                const canvasService = system.basicServices.find(s => s.id === 1);
                if (canvasService && !selectedServices.some(s => s.id === 1)) {
                    // –£—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º –∑–Ω–∞—á–µ–Ω–∏–µ –≤ –ø–æ–ª–µ –≤–≤–æ–¥–∞
                    const canvasInput = document.querySelector('.quantity-input[data-id="1"]');
                    if (canvasInput) {
                        canvasInput.value = area;
                    }
                    
                    selectedServices.push({
                        ...canvasService,
                        quantity: area,
                        total: canvasService.price * area
                    });
                }
            }
            
            // –ü—Ä–æ—Ñ–∏–ª—å (–µ—Å–ª–∏ —É–∫–∞–∑–∞–Ω –ø–µ—Ä–∏–º–µ—Ç—Ä)
            if (perimeter > 0) {
                const profileService = system.basicServices.find(s => s.id === 2);
                if (profileService && !selectedServices.some(s => s.id === 2)) {
                    // –£—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º –∑–Ω–∞—á–µ–Ω–∏–µ –≤ –ø–æ–ª–µ –≤–≤–æ–¥–∞
                    const profileInput = document.querySelector('.quantity-input[data-id="2"]');
                    if (profileInput) {
                        profileInput.value = perimeter;
                    }
                    
                    selectedServices.push({
                        ...profileService,
                        quantity: perimeter,
                        total: profileService.price * perimeter
                    });
                }
                
                // –í—Å—Ç–∞–≤–∫–∞ –ø–æ –ø–µ—Ä–∏–º–µ—Ç—Ä—É (–µ—Å–ª–∏ —É–∫–∞–∑–∞–Ω –ø–µ—Ä–∏–º–µ—Ç—Ä)
                const insertService = system.basicServices.find(s => s.id === 3);
                if (insertService && !selectedServices.some(s => s.id === 3)) {
                    // –£—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º –∑–Ω–∞—á–µ–Ω–∏–µ –≤ –ø–æ–ª–µ –≤–≤–æ–¥–∞
                    const insertInput = document.querySelector('.quantity-input[data-id="3"]');
                    if (insertInput) {
                        insertInput.value = perimeter;
                    }
                    
                    selectedServices.push({
                        ...insertService,
                        quantity: perimeter,
                        total: insertService.price * perimeter
                    });
                }
            }
            
            // –†–∞—Å—Å—á–∏—Ç—ã–≤–∞–µ–º –æ–±—â–∏–µ —Å—É–º–º—ã
            let materialsCost = 0;
            let workCost = 0;
            let equipmentCost = 0;
            
            // –†–∞–∑–¥–µ–ª—è–µ–º —Å—Ç–æ–∏–º–æ—Å—Ç—å –Ω–∞ –º–∞—Ç–µ—Ä–∏–∞–ª—ã –∏ —Ä–∞–±–æ—Ç—ã
            selectedServices.forEach(service => {
                const materialPart = service.basePrice * service.quantity;
                const workPart = (service.price - service.basePrice) * service.quantity;
                materialsCost += materialPart;
                workCost += workPart;
            });
            
            // –°—Ç–æ–∏–º–æ—Å—Ç—å –æ–±–æ—Ä—É–¥–æ–≤–∞–Ω–∏—è
            selectedEquipment.forEach(item => {
                equipmentCost += item.total;
            });
            
            const totalCost = materialsCost + workCost + equipmentCost;
            
            // –û–±–Ω–æ–≤–ª—è–µ–º –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å
            document.getElementById('materialsCost').textContent = formatCurrency(materialsCost);
            document.getElementById('workCost').textContent = formatCurrency(workCost);
            document.getElementById('equipmentCost').textContent = formatCurrency(equipmentCost);
            document.getElementById('totalCost').textContent = formatCurrency(totalCost);
            
            // –û–±–Ω–æ–≤–ª—è–µ–º –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—é –æ–± –æ–ø–ª–∞—Ç–µ
            const prepayment = totalCost * 0.5;
            const finalPayment = totalCost * 0.5;
            document.getElementById('prepaymentAmount').textContent = formatCurrency(prepayment);
            document.getElementById('finalPaymentAmount').textContent = formatCurrency(finalPayment);
            
            // –û–±–Ω–æ–≤–ª—è–µ–º —Å–≤–æ–¥–Ω—É—é —Ç–∞–±–ª–∏—Ü—É
            updateSummaryTable();
            
            // –û–±–Ω–æ–≤–ª—è–µ–º –≥—Ä–∞—Ñ–∏–∫–∏
            updateCharts(materialsCost, workCost, equipmentCost);
        }
        
        // –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ —Å–≤–æ–¥–Ω–æ–π —Ç–∞–±–ª–∏—Ü—ã
        function updateSummaryTable() {
            const tableBody = document.getElementById('summaryTableBody');
            tableBody.innerHTML = '';
            
            if (selectedServices.length === 0 && selectedEquipment.length === 0) {
                tableBody.innerHTML = `
                    <tr>
                        <td colspan="4" class="empty-state">
                            <i class="fas fa-clipboard-list"></i>
                            <p>–î–æ–±–∞–≤—å—Ç–µ —ç–ª–µ–º–µ–Ω—Ç—ã –¥–ª—è —Ä–∞—Å—á–µ—Ç–∞</p>
                        </td>
                    </tr>
                `;
                return;
            }
            
            // –î–æ–±–∞–≤–ª—è–µ–º —É—Å–ª—É–≥–∏
            selectedServices.forEach(item => {
                const row = document.createElement('tr');
                row.innerHTML = `
                    <td>${item.name}</td>
                    <td>${item.quantity} ${item.unit}</td>
                    <td>${formatCurrency(item.price)}</td>
                    <td>${formatCurrency(item.total)}</td>
                `;
                tableBody.appendChild(row);
            });
            
            // –î–æ–±–∞–≤–ª—è–µ–º –æ–±–æ—Ä—É–¥–æ–≤–∞–Ω–∏–µ
            selectedEquipment.forEach(item => {
                const row = document.createElement('tr');
                row.innerHTML = `
                    <td>${item.name} (–æ–±–æ—Ä—É–¥–æ–≤–∞–Ω–∏–µ)</td>
                    <td>${item.quantity} ${item.unit}</td>
                    <td>${formatCurrency(item.price)}</td>
                    <td>${formatCurrency(item.total)}</td>
                `;
                tableBody.appendChild(row);
            });
            
            // –î–æ–±–∞–≤–ª—è–µ–º –∏—Ç–æ–≥–æ–≤—É—é —Å—Ç—Ä–æ–∫—É
            const materialsCost = selectedServices.reduce((sum, s) => sum + (s.basePrice * s.quantity), 0);
            const workCost = selectedServices.reduce((sum, s) => sum + ((s.price - s.basePrice) * s.quantity), 0);
            const equipmentCost = selectedEquipment.reduce((sum, e) => sum + e.total, 0);
            const totalCost = materialsCost + workCost + equipmentCost;
            
            const totalRow = document.createElement('tr');
            totalRow.className = 'total-row';
            totalRow.innerHTML = `
                <td colspan="3"><strong>–ò–¢–û–ì–û:</strong></td>
                <td><strong>${formatCurrency(totalCost)}</strong></td>
            `;
            tableBody.appendChild(totalRow);
        }
        
        // –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–∏ –æ–± –æ–±—ä–µ–∫—Ç–µ
        function updateSummary() {
            // –ú–æ–∂–Ω–æ –¥–æ–±–∞–≤–∏—Ç—å –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏–µ —ç—Ç–æ–π –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–∏ –≥–¥–µ-–Ω–∏–±—É–¥—å –≤ –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å–µ
            const address = document.getElementById('objectAddress').value;
            if (address) {
                console.log(`–ê–¥—Ä–µ—Å –æ–±—ä–µ–∫—Ç–∞: ${address}`);
            }
        }
        
        // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –≥—Ä–∞—Ñ–∏–∫–æ–≤
        function initializeCharts() {
            // –ì—Ä–∞—Ñ–∏–∫ —Ä–∞—Å–ø—Ä–µ–¥–µ–ª–µ–Ω–∏—è —Å—Ç–æ–∏–º–æ—Å—Ç–∏
            const costCtx = document.getElementById('costDistributionChart').getContext('2d');
            costChart = new Chart(costCtx, {
                type: 'doughnut',
                data: {
                    labels: ['–ú–∞—Ç–µ—Ä–∏–∞–ª—ã', '–†–∞–±–æ—Ç—ã', '–û–±–æ—Ä—É–¥–æ–≤–∞–Ω–∏–µ'],
                    datasets: [{
                        data: [0, 0, 0],
                        backgroundColor: ['#1e3c72', '#2a5298', '#3a6bc9'],
                        borderWidth: 2,
                        borderColor: '#fff'
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                        legend: {
                            position: 'bottom',
                            labels: {
                                padding: 15,
                                font: {
                                    size: 12
                                }
                            }
                        },
                        tooltip: {
                            callbacks: {
                                label: function(context) {
                                    const label = context.label || '';
                                    const value = context.raw || 0;
                                    const total = context.dataset.data.reduce((a, b) => a + b, 0);
                                    const percentage = total > 0 ? Math.round((value / total) * 100) : 0;
                                    return `${label}: ${formatCurrency(value)} (${percentage}%)`;
                                }
                            }
                        }
                    }
                }
            });
        }
        
        // –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –≥—Ä–∞—Ñ–∏–∫–æ–≤
        function updateCharts(materialsCost, workCost, equipmentCost) {
            if (costChart) {
                costChart.data.datasets[0].data = [materialsCost, workCost, equipmentCost];
                costChart.update();
            }
        }
        
        // –°–±—Ä–æ—Å –∫–∞–ª—å–∫—É–ª—è—Ç–æ—Ä–∞
        function resetCalculator() {
            if (!confirm('–í—ã —É–≤–µ—Ä–µ–Ω—ã, —á—Ç–æ —Ö–æ—Ç–∏—Ç–µ —Å–±—Ä–æ—Å–∏—Ç—å –≤—Å–µ –¥–∞–Ω–Ω—ã–µ?')) {
                return;
            }
            
            // –°–±—Ä–æ—Å –ø–æ–ª–µ–π –≤–≤–æ–¥–∞ –ø–∞—Ä–∞–º–µ—Ç—Ä–æ–≤
            document.getElementById('area').value = 0;
            document.getElementById('perimeter').value = 0;
            document.getElementById('height').value = 0;
            document.getElementById('objectAddress').value = '';
            document.getElementById('roomCount').value = 1;
            
            // –°–±—Ä–æ—Å –ø–æ–ª–µ–π –∫–æ–ª–∏—á–µ—Å—Ç–≤–∞ —É—Å–ª—É–≥ –∏ –æ–±–æ—Ä—É–¥–æ–≤–∞–Ω–∏—è
            document.querySelectorAll('.quantity-input').forEach(input => {
                input.value = 0;
            });
            
            // –°–±—Ä–æ—Å –≤—ã–±—Ä–∞–Ω–Ω–æ–π —Å–∏—Å—Ç–µ–º—ã
            document.querySelectorAll('.system-btn').forEach(btn => {
                btn.classList.remove('active');
            });
            document.querySelector('.system-btn[data-system="garpun"]').classList.add('active');
            currentSystem = 'garpun';
            
            // –ü–µ—Ä–µ–∑–∞–≥—Ä—É–∑–∫–∞ —É—Å–ª—É–≥
            loadServices();
            
            // –ü–µ—Ä–µ—Ä–∞—Å—á–µ—Ç
            calculateEstimate();
            
            // –ü–µ—Ä–µ—Ö–æ–¥ –Ω–∞ –ø–µ—Ä–≤—É—é –≤–∫–ª–∞–¥–∫—É
            document.querySelector('.nav-tab[data-tab="parameters"]').click();
            
            showToast('–í—Å–µ –¥–∞–Ω–Ω—ã–µ —Å–±—Ä–æ—à–µ–Ω—ã', 2000);
        }
        
        // –°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ —Å–º–µ—Ç—ã
        function saveEstimate() {
            const materialsCost = parseFloat(document.getElementById('materialsCost').textContent.replace(/[^\d.]/g, ''));
            const workCost = parseFloat(document.getElementById('workCost').textContent.replace(/[^\d.]/g, ''));
            const equipmentCost = parseFloat(document.getElementById('equipmentCost').textContent.replace(/[^\d.]/g, ''));
            const totalCost = parseFloat(document.getElementById('totalCost').textContent.replace(/[^\d.]/g, ''));
            
            const address = document.getElementById('objectAddress').value || '–ù–µ —É–∫–∞–∑–∞–Ω';
            const objectType = document.getElementById('objectType').value;
            const roomCount = document.getElementById('roomCount').value;
            const systemName = systemsData[currentSystem].name;
            
            const estimateData = {
                objectType,
                address,
                roomCount,
                systemName,
                materialsCost,
                workCost,
                equipmentCost,
                totalCost,
                services: selectedServices,
                equipment: selectedEquipment,
                date: new Date().toISOString()
            };
            
            // –°–æ—Ö—Ä–∞–Ω—è–µ–º –≤ localStorage
            const estimates = JSON.parse(localStorage.getItem('potolokEstimates') || '[]');
            estimates.push(estimateData);
            localStorage.setItem('potolokEstimates', JSON.stringify(estimates));
            
            showToast('–°–º–µ—Ç–∞ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∞!', 2000);
        }
        
        // –û—Ç–ø—Ä–∞–≤–∫–∞ –≤ Telegram
        function sendToTelegram() {
            const materialsCost = parseFloat(document.getElementById('materialsCost').textContent.replace(/[^\d.]/g, ''));
            const workCost = parseFloat(document.getElementById('workCost').textContent.replace(/[^\d.]/g, ''));
            const equipmentCost = parseFloat(document.getElementById('equipmentCost').textContent.replace(/[^\d.]/g, ''));
            const totalCost = parseFloat(document.getElementById('totalCost').textContent.replace(/[^\d.]/g, ''));
            
            const address = document.getElementById('objectAddress').value || '–ù–µ —É–∫–∞–∑–∞–Ω';
            const objectType = document.getElementById('objectType').value;
            const roomCount = document.getElementById('roomCount').value;
            const area = document.getElementById('area').value || 0;
            const systemName = systemsData[currentSystem].name;
            
            // –§–æ—Ä–º–∏—Ä—É–µ–º —Å–æ–æ–±—â–µ–Ω–∏–µ –¥–ª—è Telegram
            const message = `üè† *–°–º–µ—Ç–∞ –Ω–∞ –Ω–∞—Ç—è–∂–Ω—ã–µ –ø–æ—Ç–æ–ª–∫–∏*\n\n` +
                           `*–¢–∏–ø –æ–±—ä–µ–∫—Ç–∞:* ${objectType}\n` +
                           `*–ê–¥—Ä–µ—Å:* ${address}\n` +
                           `*–ü–æ–º–µ—â–µ–Ω–∏–π:* ${roomCount}\n` +
                           `*–ü–ª–æ—â–∞–¥—å:* ${area} –º¬≤\n` +
                           `*–°–∏—Å—Ç–µ–º–∞:* ${systemName}\n\n` +
                           `*–°—Ç–æ–∏–º–æ—Å—Ç—å –º–∞—Ç–µ—Ä–∏–∞–ª–æ–≤:* ${formatCurrency(materialsCost)}\n` +
                           `*–°—Ç–æ–∏–º–æ—Å—Ç—å —Ä–∞–±–æ—Ç:* ${formatCurrency(workCost)}\n` +
                           `*–û–±–æ—Ä—É–¥–æ–≤–∞–Ω–∏–µ:* ${formatCurrency(equipmentCost)}\n\n` +
                           `üéØ *–ò–¢–û–ì–û: ${formatCurrency(totalCost)}*\n\n` +
                           `üìû *–î–ª—è –∑–∞–∫–∞–∑–∞:*\n` +
                           `–¢–µ–ª–µ—Ñ–æ–Ω: 8(977)531-10-99\n` +
                           `Email: Potolokforlife@yandex.ru\n\n` +
                           `üìÖ ${new Date().toLocaleString('ru-RU')}`;
            
            // –ï—Å–ª–∏ –æ—Ç–∫—Ä—ã—Ç–æ –≤ Telegram Web App
            if (tg) {
                // –û—Ç–ø—Ä–∞–≤–ª—è–µ–º –¥–∞–Ω–Ω—ã–µ –≤ Telegram
                tg.sendData(JSON.stringify({
                    type: 'estimate',
                    totalCost: totalCost,
                    address: address,
                    area: area,
                    roomCount: roomCount,
                    objectType: objectType,
                    systemName: systemName,
                    message: message
                }));
                
                // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ
                tg.showAlert('‚úÖ –°–º–µ—Ç–∞ –æ—Ç–ø—Ä–∞–≤–ª–µ–Ω–∞!\n\n–ú–µ–Ω–µ–¥–∂–µ—Ä —Å–≤—è–∂–µ—Ç—Å—è —Å –≤–∞–º–∏ –≤ —Ç–µ—á–µ–Ω–∏–µ 30 –º–∏–Ω—É—Ç.', function() {
                    tg.close();
                });
            } else {
                // –ï—Å–ª–∏ –æ—Ç–∫—Ä—ã—Ç–æ –≤ –±—Ä–∞—É–∑–µ—Ä–µ
                alert('–°–æ–æ–±—â–µ–Ω–∏–µ –¥–ª—è –º–µ–Ω–µ–¥–∂–µ—Ä–∞:\n\n' + message.replace(/\*/g, ''));
                
                // –ú–æ–∂–Ω–æ –æ—Ç–∫—Ä—ã—Ç—å WhatsApp —Å —Å–æ–æ–±—â–µ–Ω–∏–µ–º
                const whatsappMessage = `–ó–¥—Ä–∞–≤—Å—Ç–≤—É–π—Ç–µ! –†–∞—Å—Å—á–∏—Ç–∞–ª —Å—Ç–æ–∏–º–æ—Å—Ç—å –Ω–∞—Ç—è–∂–Ω–æ–≥–æ –ø–æ—Ç–æ–ª–∫–∞:\n\n` +
                                      `–ê–¥—Ä–µ—Å: ${address}\n` +
                                      `–ü–ª–æ—â–∞–¥—å: ${area} –º¬≤\n` +
                                      `–°—Ç–æ–∏–º–æ—Å—Ç—å: ${formatCurrency(totalCost)}\n\n` +
                                      `–ü—Ä–æ—à—É —Å–≤—è–∑–∞—Ç—å—Å—è —Å–æ –º–Ω–æ–π –¥–ª—è —É—Ç–æ—á–Ω–µ–Ω–∏—è –¥–µ—Ç–∞–ª–µ–π.`;
                
                const whatsappUrl = `https://wa.me/79775311099?text=${encodeURIComponent(whatsappMessage)}`;
                window.open(whatsappUrl, '_blank');
            }
        }
        
        // –ü–µ—á–∞—Ç—å —Å–º–µ—Ç—ã
        function printEstimate() {
            const materialsCost = parseFloat(document.getElementById('materialsCost').textContent.replace(/[^\d.]/g, ''));
            const workCost = parseFloat(document.getElementById('workCost').textContent.replace(/[^\d.]/g, ''));
            const equipmentCost = parseFloat(document.getElementById('equipmentCost').textContent.replace(/[^\d.]/g, ''));
            const totalCost = parseFloat(document.getElementById('totalCost').textContent.replace(/[^\d.]/g, ''));
            
            const address = document.getElementById('objectAddress').value || '–ù–µ —É–∫–∞–∑–∞–Ω';
            const objectType = document.getElementById('objectType').value;
            const roomCount = document.getElementById('roomCount').value;
            const systemName = systemsData[currentSystem].name;
            
            // –°–æ–∑–¥–∞–µ–º —Å–æ–¥–µ—Ä–∂–∏–º–æ–µ –¥–ª—è –ø–µ—á–∞—Ç–∏
            const printContent = `
                <html>
                <head>
                    <title>–°–º–µ—Ç–∞ PotolokForLife</title>
                    <style>
                        body { font-family: Arial, sans-serif; padding: 20px; max-width: 800px; margin: 0 auto; }
                        .header { text-align: center; margin-bottom: 30px; border-bottom: 2px solid #1e3c72; padding-bottom: 20px; }
                        .header h1 { color: #1e3c72; margin-bottom: 10px; }
                        .info { margin-bottom: 20px; padding: 15px; background: #f0f7ff; border-radius: 8px; }
                        .info table { width: 100%; border-collapse: collapse; }
                        .info td { padding: 8px; border-bottom: 1px solid #ddd; }
                        .summary { background: #f0f7ff; padding: 20px; border-radius: 8px; margin: 20px 0; }
                        .summary-item { display: flex; justify-content: space-between; margin-bottom: 10px; }
                        .total { font-size: 24px; font-weight: bold; color: #1e3c72; text-align: center; margin: 20px 0; padding: 15px; border-top: 2px solid #1e3c72; }
                        table { width: 100%; border-collapse: collapse; margin-top: 20px; }
                        th, td { padding: 12px; text-align: left; border-bottom: 1px solid #ddd; }
                        th { background: #f8f9fa; color: #1e3c72; }
                        .footer { margin-top: 30px; padding-top: 20px; border-top: 1px solid #ddd; font-size: 12px; color: #666; }
                        @media print {
                            body { padding: 0; }
                            .no-print { display: none; }
                        }
                    </style>
                </head>
                <body>
                    <div class="header">
                        <h1>PotolokForLife</h1>
                        <p>–ù–∞—Ç—è–∂–Ω—ã–µ –ø–æ—Ç–æ–ª–∫–∏ –Ω–∞ –≤—Å—é –∂–∏–∑–Ω—å ‚Ä¢ –ü—É—à–∫–∏–Ω–æ</p>
                        <p>Email: Potolokforlife@yandex.ru ‚Ä¢ –¢–µ–ª: 8(977)531-10-99, 8(977)709-38-43</p>
                    </div>
                    
                    <div class="info">
                        <h2>–ò–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –æ–± –æ–±—ä–µ–∫—Ç–µ</h2>
                        <table>
                            <tr><td><strong>–¢–∏–ø –æ–±—ä–µ–∫—Ç–∞:</strong></td><td>${objectType}</td></tr>
                            <tr><td><strong>–ê–¥—Ä–µ—Å:</strong></td><td>${address}</td></tr>
                            <tr><td><strong>–ö–æ–ª–∏—á–µ—Å—Ç–≤–æ –ø–æ–º–µ—â–µ–Ω–∏–π:</strong></td><td>${roomCount}</td></tr>
                            <tr><td><strong>–°–∏—Å—Ç–µ–º–∞ –ø–æ—Ç–æ–ª–∫–∞:</strong></td><td>${systemName}</td></tr>
                            <tr><td><strong>–î–∞—Ç–∞ —Ä–∞—Å—á–µ—Ç–∞:</strong></td><td>${new Date().toLocaleDateString('ru-RU')}</td></tr>
                        </table>
                    </div>
                    
                    <div class="summary">
                        <h2>–°–≤–æ–¥–∫–∞ –ø–æ —Å—Ç–æ–∏–º–æ—Å—Ç–∏</h2>
                        <div class="summary-item">
                            <span>–ú–∞—Ç–µ—Ä–∏–∞–ª—ã:</span>
                            <span>${formatCurrency(materialsCost)}</span>
                        </div>
                        <div class="summary-item">
                            <span>–†–∞–±–æ—Ç—ã:</span>
                            <span>${formatCurrency(workCost)}</span>
                        </div>
                        <div class="summary-item">
                            <span>–û–±–æ—Ä—É–¥–æ–≤–∞–Ω–∏–µ:</span>
                            <span>${formatCurrency(equipmentCost)}</span>
                        </div>
                    </div>
                    
                    <div class="total">–ò–¢–û–ì–û: ${formatCurrency(totalCost)}</div>
                    
                    <h2>–î–µ—Ç–∞–ª–∏–∑–∞—Ü–∏—è —Å–º–µ—Ç—ã</h2>
                    <table>
                        <thead>
                            <tr>
                                <th>–ù–∞–∏–º–µ–Ω–æ–≤–∞–Ω–∏–µ</th>
                                <th>–ö–æ–ª-–≤–æ</th>
                                <th>–¶–µ–Ω–∞</th>
                                <th>–°—É–º–º–∞</th>
                            </tr>
                        </thead>
                        <tbody>
                            ${selectedServices.map(item => `
                                <tr>
                                    <td>${item.name}</td>
                                    <td>${item.quantity} ${item.unit}</td>
                                    <td>${formatCurrency(item.price)}</td>
                                    <td>${formatCurrency(item.total)}</td>
                                </tr>
                            `).join('')}
                            ${selectedEquipment.map(item => `
                                <tr>
                                    <td>${item.name} (–æ–±–æ—Ä—É–¥–æ–≤–∞–Ω–∏–µ)</td>
                                    <td>${item.quantity} ${item.unit}</td>
                                    <td>${formatCurrency(item.price)}</td>
                                    <td>${formatCurrency(item.total)}</td>
                                </tr>
                            `).join('')}
                            <tr style="font-weight: bold; background: #f0f0f0;">
                                <td colspan="3">–ò–¢–û–ì–û:</td>
                                <td>${formatCurrency(totalCost)}</td>
                            </tr>
                        </tbody>
                    </table>
                    
                    <div class="footer">
                        <p><strong>–ü–æ—Ä—è–¥–æ–∫ –æ–ø–ª–∞—Ç—ã:</strong></p>
                        <p>1. –ü—Ä–µ–¥–æ–ø–ª–∞—Ç–∞ 50% (${formatCurrency(totalCost * 0.5)}) –Ω–µ –ø–æ–∑–¥–Ω–µ–µ 3-—Ö –¥–Ω–µ–π –¥–æ –ø–ª–∞–Ω–∏—Ä—É–µ–º–æ–π –¥–∞—Ç—ã –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è –º–æ–Ω—Ç–∞–∂–∞ 1-–≥–æ —ç—Ç–∞–ø–∞.</p>
                        <p>2. –û–∫–æ–Ω—á–∞—Ç–µ–ª—å–Ω—ã–π —Ä–∞—Å—á–µ—Ç 50% (${formatCurrency(totalCost * 0.5)}) –≤ –¥–µ–Ω—å –∑–∞–≤–µ—Ä—à–µ–Ω–∏—è –≤—Å–µ—Ö —Ä–∞–±–æ—Ç.</p>
                        <p>3. –û–ø–ª–∞—Ç–∞ –∑–∞ –º–∞—Ç–µ—Ä–∏–∞–ª—ã –∏–∑ —Ä–∞–∑–¥–µ–ª–∞ "–û–±–æ—Ä—É–¥–æ–≤–∞–Ω–∏–µ" –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç—Å—è –∏–∑ —Ä–∞—Å—á–µ—Ç–∞ 100% –¥–æ –Ω–∞—á–∞–ª–∞ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è —Ä–∞–±–æ—Ç.</p>
                        <p class="no-print">–°–º–µ—Ç–∞ —Å–≥–µ–Ω–µ—Ä–∏—Ä–æ–≤–∞–Ω–∞ –≤ –º–æ–±–∏–ª—å–Ω–æ–º –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–∏ PotolokForLife</p>
                    </div>
                </body>
                </html>
            `;
            
            // –û—Ç–∫—Ä—ã–≤–∞–µ–º –Ω–æ–≤–æ–µ –æ–∫–Ω–æ –¥–ª—è –ø–µ—á–∞—Ç–∏
            const printWindow = window.open('', '_blank');
            printWindow.document.write(printContent);
            printWindow.document.close();
            printWindow.focus();
            
            // –î–∞–µ–º –≤—Ä–µ–º—è –Ω–∞ –∑–∞–≥—Ä—É–∑–∫—É –∫–æ–Ω—Ç–µ–Ω—Ç–∞ –ø–µ—Ä–µ–¥ –ø–µ—á–∞—Ç—å—é
            setTimeout(() => {
                printWindow.print();
                printWindow.close();
            }, 500);
        }
        
        // –§–æ—Ä–º–∞—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –≤–∞–ª—é—Ç—ã
        function formatCurrency(amount) {
            return new Intl.NumberFormat('ru-RU', {
                style: 'currency',
                currency: 'RUB',
                minimumFractionDigits: 0,
                maximumFractionDigits: 0
            }).format(amount).replace('RUB', '—Ä—É–±.');
        }
        
        // –ü–æ–∫–∞–∑–∞—Ç—å toast-—É–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ
        function showToast(message, duration = 3000) {
            const toast = document.getElementById('toast');
            toast.textContent = message;
            toast.classList.add('show');
            
            setTimeout(() => {
                toast.classList.remove('show');
            }, duration);
        }
        
        // –ü—Ä–µ–¥–æ—Ç–≤—Ä–∞—â–µ–Ω–∏–µ —Å–ª—É—á–∞–π–Ω–æ–≥–æ –∑–∞–∫—Ä—ã—Ç–∏—è —Å—Ç—Ä–∞–Ω–∏—Ü—ã –ø—Ä–∏ –Ω–∞–ª–∏—á–∏–∏ –¥–∞–Ω–Ω—ã—Ö
        window.addEventListener('beforeunload', function(e) {
            const totalCost = parseFloat(document.getElementById('totalCost').textContent.replace(/[^\d.]/g, ''));
            if (totalCost > 0) {
                e.preventDefault();
                e.returnValue = '–£ –≤–∞—Å –µ—Å—Ç—å –Ω–µ—Å–æ—Ö—Ä–∞–Ω–µ–Ω–Ω–∞—è —Å–º–µ—Ç–∞. –í—ã —É–≤–µ—Ä–µ–Ω—ã, —á—Ç–æ —Ö–æ—Ç–∏—Ç–µ –ø–æ–∫–∏–Ω—É—Ç—å —Å—Ç—Ä–∞–Ω–∏—Ü—É?';
            }
        });
    </script>
</body>
</html>
